import{aA as e,al as a,as as l,o as n,p as s,n as t,F as i,aD as c,ae as o,w as d,aT as r,x as u,bj as v,aw as h,at as m,aF as g,ac as p,bl as y,bb as f,a$ as b,m as k}from"./chunk-vue-0eb5cee7.js";import{_ as C}from"./back-9f3fbace.js";import{c as _}from"./Layout-442da1ba.js";import{g as w,u as x,$ as j,E as I,G as S,n as O,a0 as P,a4 as A,a5 as q,a3 as $,j as E,o as F,H as L}from"./chunk-vform-c3afb8ec.js";import{a as U}from"./authorityManagement-4f925147.js";import"./chunk-element-plus-b8773542.js";import"./chunk-ant-design-vue-bd7f8294.js";import"./chunk-@ant-design-icons-svg-8f5189a2.js";import"./chunk-@ant-design-icons-vue-ff9a333c.js";const B=e=>(h("data-v-ce06d115"),e=e(),m(),e),D={class:"permission-selected"},R={key:0,class:"label"},N=[B((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#bumen"})],-1))),d(" 选中部门 ")],V={key:1,class:"permission-selected-role-list"},z={key:0},M={key:1},G=["onClick"],H={key:0,class:"child-organ"},Q=["onClick"],T={key:2,class:"label"},J=[B((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#yuangong"})],-1))),d(" 选中员工")],K={key:3,class:"permission-selected-role-list"},W={class:"organ"},X={class:"role-container-a"},Y=B((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#yuangong"})],-1))),Z=["onClick"],ee=B((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#role-active"})],-1))),ae={key:4,class:"empty"},le=[B((()=>s("div",{class:"box"},[s("div",null,[s("img",{src:P})])],-1)))],ne={class:"permission-selected-role-list"},se={class:"role-container",ref:"roleRef"},te=B((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#yuangong"})],-1))),ie={name:"Selected"},ce=w(Object.assign(ie,{setup(h){const m=x(),g=e({organs:[],users:[]}),p=e(!1),y=e([]),f=e=>e.map((e=>e.name)).join(" > "),b=async e=>{try{p.value=!0;const a=await S.userListByOrgan(e);y.value=a.data}catch(a){I(a)}};return(async()=>{try{const e=await j.systemOrganOrPerson.getRoleDataScopeEcho(m.query.roleId);g.value=e.data}catch(e){I(e)}})(),a((()=>{})),(e,a)=>{const h=O;return l(),n(i,null,[s("div",D,[g.value.organs.length?(l(),n("p",R,N)):t("",!0),g.value.organs.length?(l(),n("div",V,[(l(!0),n(i,null,c(g.value.organs,((e,a)=>(l(),n("div",{key:a},[s("div",{class:"organ",style:o(["0"===e.includeChild?"margin-bottom: 24px":"",{display:"flex","justify-content":"space-between"}])},[s("p",null,[d(r(f(e.organInfo))+" ",1),"0"===e.includeChild?(l(),n("span",z,"（不包含下级）")):(l(),n("span",M,"（包含下级）"))]),"0"===e.includeChild?(l(),n("a",{key:0,onClick:a=>b(e.organInfo[0].id)},"查看员工 》",8,G)):t("",!0)],4),"0"!==e.includeChild?(l(),n("div",H,[(l(!0),n(i,null,c(e.subOrganInfoList,((e,a)=>(l(),n("div",{class:"organ",style:{"margin-bottom":"24px",display:"flex","justify-content":"space-between"},key:a},[s("p",null,r(f(e)),1),s("a",{onClick:a=>b(e[e.length-1].id)},"查看员工 》",8,Q)])))),128))])):t("",!0)])))),128))])):t("",!0),g.value.users.length?(l(),n("p",T,J)):t("",!0),g.value.users.length?(l(),n("div",K,[(l(!0),n(i,null,c(g.value.users,((e,a)=>(l(),n("div",{key:a},[s("div",W,r(f(e.organInfo)),1),s("div",{class:"role-container",ref_for:!0,ref:"roleRef"},[s("div",X,[(l(!0),n(i,null,c(e.userInfo.slice(0,9),((e,a)=>(l(),n("div",{key:a,class:"role"},[Y,d(" "+r(e.name),1)])))),128))]),e.userInfo.length>3?(l(),n("div",{key:0,class:"role sum",onClick:a=>{return l=e.userInfo,p.value=!0,void(y.value=l);var l}},[ee,d(" +"+r(e.userInfo.length),1)],8,Z)):t("",!0)],512)])))),128))])):t("",!0),g.value.users.length||g.value.organs.length?t("",!0):(l(),n("div",ae,le))]),u(h,{"onUpdate:show":a[0]||(a[0]=e=>p.value=e),show:p.value,"destroy-on-close":"",title:"成员信息",width:900,footer:!1},{default:v((()=>[s("div",ne,[s("div",se,[(l(!0),n(i,null,c(y.value,((e,a)=>(l(),n("div",{key:a,class:"role"},[te,d(" "+r(e.name),1)])))),128))],512)])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-ce06d115"]]),oe=e=>(h("data-v-0a5af12b"),e=e(),m(),e),de={class:"Functions-container"},re={class:"container1 container"},ue={key:0,class:"container2 container"},ve={class:"left"},he=["onClick"],me=[oe((()=>s("use",{href:"#down"},null,-1)))],ge={class:"right"},pe={key:0},ye=oe((()=>s("template",null,null,-1))),fe=d("   "),be={key:0,class:"container3 container"},ke={class:"left"},Ce=["onClick"],_e=[oe((()=>s("use",{href:"#down"},null,-1)))],we={class:"right"},xe={key:0},je=d("   "),Ie={key:0,class:"container4 container"},Se={class:"left"},Oe=["onClick"],Pe=[oe((()=>s("use",{href:"#down"},null,-1)))],Ae={class:"right"},qe={key:0},$e=d("   "),Ee={key:0,class:"container5 container"},Fe={class:"left"},Le={class:"right"},Ue={key:0},Be=d("   "),De={class:"bottom-btns"},Re=d("确认"),Ne=d("重置"),Ve={name:""},ze=w(Object.assign(Ve,{setup(o){const h=e([]),m=e([]),y=e([]),f=e([]),b=x(),k=(e,a)=>!(!e||!e.length)&&!!e.find((e=>e.type===a)),C=(e,a)=>{a.putAway?(document.getElementsByClassName(`${e}-model`)[0].classList.add("height-0"),a.putAway=!1):(document.getElementsByClassName(`${e}-model`)[0].classList.remove("height-0"),a.putAway=!0)},_=e=>{const a=m.value.includes(e.id);if(a&&"point"!==e.type){if(e.children){const a=A([e],"children","id");m.value=Array.from(new Set([...m.value,...a]))}w(e).forEach((e=>{const a=A([e],"children","id");m.value.filter((e=>a.includes(e))).length===a.length-1&&m.value.push(e.id)}))}if(!a&&"point"!==e.type&&e.children){const a=A([e],"children","id");m.value=m.value.filter((e=>!a.includes(e)))}},w=e=>{const a=[];for(;"-1"!==e.pid;)e=q(h.value,"children","id",e.pid)[0],a.push(e);return a},j=e=>{if(m.value.includes(e.id))return!1;const a=A([e],"children").filter((e=>"point"!==e.type)).map((e=>e.id));return!!m.value.filter((e=>a.includes(e))).length},O=async()=>{try{await S.roleFunctionEdit({roleId:b.query.roleId,functionIds:m.value}),$("角色权限修改成功")}catch(e){I(e)}};return a((()=>{(async()=>{try{const e=await S.getAllPublic();h.value=e.data,y.value=h.value.map((e=>e.id)),f.value.push(y.value[0])}catch(e){I(e)}})(),(async()=>{try{const e=await S.getSelectedFunctionIds(b.query.roleId);m.value=e.data}catch(e){I(e)}})()})),(e,a)=>{const o=g("el-checkbox"),y=g("el-checkbox-group"),f=g("el-scrollbar"),b=g("el-button");return l(),n("div",de,[u(f,{height:"calc(100vh - 300px)",style:{padding:"10px 24px 24px 24px"}},{default:v((()=>[u(y,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e)},{default:v((()=>[(l(!0),n(i,null,c(h.value,(e=>(l(),n(i,{key:e.id},[s("div",re,[u(o,{label:e.id,indeterminate:j(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",ue,[s("div",ve,[k(e.children,"menu")||k(e.children,"tab")?(l(),n("svg",{key:0,class:"iconpark-icon",onClick:a=>C(e.id,e)},me,8,he)):t("",!0),u(o,{label:e.id,indeterminate:j(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),s("div",ge,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",pe,[ye,u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),fe])):t("",!0)],64)))),128))])])):t("",!0),s("div",{class:p(["model height-0",[`${e.id}-model`]])},[(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",be,[s("div",ke,[k(e.children,"menu")||k(e.children,"tab")?(l(),n("svg",{key:0,class:"iconpark-icon",onClick:a=>C(e.id,e)},_e,8,Ce)):t("",!0),u(o,{label:e.id,indeterminate:j(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),s("div",we,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",xe,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),je])):t("",!0)],64)))),128))])])):t("",!0),s("div",{class:p(["model height-0",[`${e.id}-model`]])},[(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",Ie,[s("div",Se,[k(e.children,"menu")||k(e.children,"tab")?(l(),n("svg",{key:0,class:"iconpark-icon",onClick:a=>C(e.id,e)},Pe,8,Oe)):t("",!0),u(o,{label:e.id,indeterminate:j(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),s("div",Ae,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",qe,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),$e])):t("",!0)],64)))),128))])])):t("",!0),s("div",{class:p(["model height-0",[`${e.id}-model`]])},[(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",Ee,[s("div",Fe,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"])]),s("div",Le,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",Ue,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),Be])):t("",!0)],64)))),128))])])):t("",!0)],64)))),128))],2)],64)))),128))],2)],64)))),128))],2)],64)))),128))],64)))),128))])),_:1},8,["modelValue"])])),_:1},8,["height"]),s("div",De,[u(b,{type:"primary",onClick:O},{default:v((()=>[Re])),_:1}),u(b,null,{default:v((()=>[Ne])),_:1})])])}}}),[["__scopeId","data-v-0a5af12b"]]),Me=e=>(h("data-v-ea838dc6"),e=e(),m(),e),Ge={class:"accomplish-container"},He={class:"breadcrumb"},Qe=d(" 权限管理 "),Te=d(" 权限配置 "),Je={class:"title"},Ke={class:"title-desc"},We=d(" 权限配置 "),Xe={class:"role"},Ye=Me((()=>s("div",null,null,-1))),Ze={class:"custom-tabs"},ea={class:"function"},aa={key:0,class:"custom-data"},la={class:"item"},na=Me((()=>s("div",{class:"item-label"},"默认数据权限",-1))),sa={class:"i"},ta={class:"item"},ia=Me((()=>s("div",{class:"item-label"},"自定义数据权限",-1))),ca=d("编辑"),oa={class:"item"},da=Me((()=>s("div",{class:"item-label"},null,-1))),ra={name:"PermissionSelect"},ua=w(Object.assign(ra,{setup(a){const i=E(),c=x(),o=e("first"),h=e(c.query.roleName),m=e([{name:"t-zgj-person.FunctionalPermissions",value:"first"},{name:"t-zgj-person.DataPermissions",value:"second"}]),p=e({roleId:""});p.value={id:c.query.roleId};const w=e([{label:"向上继承",msg:"可以查看下级部门员工创建数据"},{label:"仅自己",msg:"仅可以查看创建人自己的数据"}]),j=e(null),O=e([]);U.getSetting().then((e=>{const a="1"===e.data.userBaseAuth?0:1;j.value=w.value[a]}));(async()=>{try{const e=await S.getAllPublic();O.value=e.data}catch(e){I(e)}})();const P=()=>{i.go(-1)},A=e(["user","organ"]),q=e(!1),$=e([]),B=()=>{q.value=!0},D=e=>{},R=e({padding:"10px 0 0px 0px"});return(e,a)=>{const i=g("el-breadcrumb-item"),c=g("el-breadcrumb"),w=g("el-button");return l(),n("div",Ge,[u(_,{Layout:"breadcrumb,title,custom,fixed",cardStyle:R.value},{breadcrumb:v((()=>[s("div",He,[u(c,{separator:"/"},{default:v((()=>[u(i,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.65)"}},{default:v((()=>[Qe])),_:1}),u(i,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.25)"}},{default:v((()=>[Te])),_:1})])),_:1})])])),title:v((()=>[s("div",Je,[s("div",Ke,[s("img",{class:"title-desc-img",src:C,alt:"",onClick:P}),We,s("span",Xe,"（"+r(h.value)+"）",1)]),Ye])])),noScroll:v((()=>[s("div",Ze,[u(F,{active:o.value,label:m.value,"onUpdate:active":a[0]||(a[0]=e=>o.value=e)},null,8,["active","label"])]),y(s("div",ea,[u(b(ze))],512),[[f,"first"===o.value]]),"second"===o.value?(l(),n("div",aa,[s("div",la,[na,s("div",null,[d(r(j.value.label)+" ",1),s("span",sa," （"+r(j.value.msg)+"） ",1)])]),s("div",ta,[ia,u(w,{type:"primary",onClick:B},{default:v((()=>[ca])),_:1})]),s("div",oa,[da,u(b(ce))])])):t("",!0)])),_:1},8,["cardStyle"]),q.value?(l(),k(L,{key:0,show:q.value,"onUpdate:show":a[1]||(a[1]=e=>q.value=e),tabsShow:A.value,"onUpdate:searchSelected":D,searchSelected:$.value,editDeploy:"",apiModule:"systemOrganOrPerson",queryParams:p.value},null,8,["show","tabsShow","searchSelected","queryParams"])):t("",!0)])}}}),[["__scopeId","data-v-ea838dc6"]]);export{ua as default};

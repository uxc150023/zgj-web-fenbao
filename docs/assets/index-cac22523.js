import{g as e,H as a,i as o,n as t,a1 as n}from"./chunk-vform-6b80d696.js";import{aA as l,ay as r,ag as d,aF as s,as as u,o as i,x as c,bj as m,p as g,w as p,aT as h,m as v,aa as f,a$ as b,n as w,bl as N,bb as y,ab as I,aw as j,at as x}from"./chunk-vue-0eb5cee7.js";import{_ as D}from"./gengduo-caozuo-e0bc5fb4.js";import{_ as k}from"./ketanchude-51586196.js";import{J as P}from"./JyTable-ee0f04c7.js";import{a as _}from"./department-962e3ce3.js";import{a as z}from"./actionMoreDialog-497c7e7b.js";import{_ as A}from"./index-7daeab44.js";import"./chunk-element-plus-b8773542.js";import"./chunk-ant-design-vue-bd7f8294.js";import"./chunk-@ant-design-icons-svg-8f5189a2.js";import"./chunk-@ant-design-icons-vue-ff9a333c.js";import"./sangedian-856844bf.js";import"./Layout-d1d9ddbf.js";import"./searchForm-7d992d01.js";import"./KDocumentTypeDialog-a877b983.js";import"./pagination-c0fecb51.js";import"./batch-f5c51482.js";import"./index-64730435.js";import"./index-ba8b9ad2.js";import"./cha-kong-4b498f35.js";import"./index-f89250d7.js";import"./yuan-hui-61924fee.js";import"./index-0061e342.js";import"./home-back-8683dc83.js";import"./logo-55df0058.js";import"./request-util-ce71abde.js";const T=[{prop:"organName",label:"部门名称","min-width":150,fixed:"left",show:!0},{prop:"organNo",label:"部门编码","min-width":150,show:!0},{prop:"organTypeName",label:"组织类型","min-width":150,show:!0},{prop:"organUserNum",label:"部门人数",sortable:"custom",align:"center",width:150,show:!0},{prop:"organLeaderName",label:"部门主管","min-width":150,show:!0},{prop:"organPName",label:"上级组织","min-width":150,show:!0},{prop:"flag",label:"状态",show:!0},{prop:"caozuo",label:"操作","min-width":250,fixed:"right",align:"center",show:!0,rankDisplayData:[{name:"t-zgj-Edit"},{name:"status"},{name:"t-zgj-Delete"}]}],B=e=>(j("data-v-36305306"),e=e(),x(),e),C={class:"title"},L=B((()=>g("div",null,"单位与部门管理",-1))),V={class:"title-more"},O={class:"title-more-add"},E={class:"title-more-down"},U=B((()=>g("img",{class:"button-icon",src:D,alt:"",srcset:""},null,-1))),S=p("导入"),F={class:"components-tree"},$=p("部门"),q=p("单位"),H={class:"select-box-contBox"},J=B((()=>g("div",{class:"ap-box-contBox-icon"},[g("img",{class:"ap-box-contBox-icon-img",src:k,alt:""})],-1))),R={class:"select-box-contBox"},W=B((()=>g("div",{class:"ap-box-contBox-icon"},[g("img",{class:"ap-box-contBox-icon-img",src:k})],-1))),M={class:"header-div"},Y=B((()=>g("img",{src:n},null,-1))),K={class:"content-div"},Q=e({setup(e){const n=l(!1),j=l([]),x=l(!1),D=l(!1),k=l(!1),B=l(null),Q=l([]),X=l(["organ"]),Z=l(null),G=l("-1"),ee=l(null),ae=l(!1),oe=l(!1),te=l(null),ne=l(null),le=l(!1),re=l(null),de=l(null),se=l(null),ue=l(null),ie=l(null),ce=l([]),me=l(null),ge=r({organId:"",organNo:"",organName:"",organTypeId:"department",organPid:"",organPName:"",organLeaderId:"",organLeaderName:"",readme:""}),pe=r({organName:[{required:!0,message:"请输入部门名称",trigger:"change"}],organPName:[{required:!0,message:"请选择上级部门",trigger:"change"}]}),he=r({showOneAction:{show:!1,header:{data:""},content:{data:""}},componentsSearchForm:{data:[{id:"keyWord",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"部门名称/部门编码"}},{id:"flag",label:"状态",type:"select",inCommonUse:!0,options:[{label:"启用",value:1},{label:"停用",value:0}],defaultAttribute:{placeholder:"请选择"}}],butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"重置",type:"click",defaultAttribute:{},style:{}}]},componentsTable:{header:T},componentsTree:{data:[],defaultAttribute:{"check-on-click-node":!0,"show-checkbox":!1,"expand-on-click-node":!1,"check-strictly":!0,"highlight-current":!0,"node-key":"organId","current-node-key":"-1",accordion:!0},defaultProps:{label:"organName",children:"children",isLeaf:"haveChildren"},value:""},componentsBatch:{selectionData:[],data:[{name:"t-zgj-dept.BatchDeactivation"},{name:"t-zgj-dept.BatchEnable"},{name:"t-zgj-seal.BatchDelete"}]}});function ve(e,a,o,t){G.value=e.organId,n.value=!0,j.value=[{value:"detail",params:e.organId},{value:"organizer",params:e.organId}]}function fe(e,a,t,n){"t-zgj-Edit"===t.name?(x.value=!0,ge.organId=a.organId,I((()=>{B.value.resetFields(),_.detail(a.organId).then((e=>{const a=e.data;ge.organId=a.organId,ge.organNo=a.organNo,ge.organName=a.organName,ge.organTypeId=a.organTypeId,ge.organPid=a.organPid,ge.organPName=a.organPName||o("accountInfo")&&o("accountInfo").userDepartName,ge.organLeaderId=a.organLeaderId,ge.organLeaderName=a.organLeaderName,ge.readme=a.readme}))}))):"t-zgj-F_SEAL_INFO_UP"===t.name||"t-zgj-F_SEAL_INFO_DOWN"===t.name||("status"===t.name?(ue.value="启用"===a.flag?"t-zgj-Disable":"t-zgj-Enable",se.value=a.organId,he.showOneAction.show=!0,he.showOneAction.header.data="提示","启用"===a.flag?he.showOneAction.content.data="是否停用该部门？":he.showOneAction.content.data="是否启用该部门？"):"t-zgj-Delete"===t.name&&(ue.value="t-zgj-Delete",se.value=a.organId,he.showOneAction.show=!0,he.showOneAction.header.data="提示",he.showOneAction.content.data="是否删除该部门？"))}function be(){"t-zgj-Enable"===ue.value?_.batchEnable([se.value]).then((e=>{ee.value.reloadData()})).finally((()=>{he.showOneAction.show=!1})):"t-zgj-Disable"===ue.value?_.batchDisable([se.value]).then((e=>{ee.value.reloadData()})).finally((()=>{he.showOneAction.show=!1})):"t-zgj-Delete"===ue.value&&_.batchDelete([se.value]).then((e=>{ee.value.reloadData(),ie.value.loaded=!1,ie.value.expand()})).finally((()=>{le.value=!1,he.showOneAction.show=!1}))}function we(e,a){re.value=e.name,"t-zgj-dept.BatchDeactivation"===e.name?de.value={header:{data:"批量停用"},content:{data:"是否批量停用这些部门？"}}:"t-zgj-dept.BatchEnable"===e.name?de.value={header:{data:"批量启用"},content:{data:"是否批量启用这些部门？"}}:"t-zgj-seal.BatchDelete"===e.name&&(de.value={header:{data:"批量删除"},content:{data:"是否批量删除这些部门？"}}),he.componentsBatch.selectionData=a,le.value=!0}const Ne=e=>{k.value=!0,Z.value=e,"organP"===e?(X.value=["organ"],Q.value=ge.organPid?[{id:ge.organPid,name:ge.organPName,type:"organ"}]:[]):(X.value=["user"],Q.value=ge.organLeaderId?[{id:ge.organLeaderId,name:ge.organLeaderName,type:"user"}]:[]),setTimeout((()=>{D.value=!0}),200)},ye=()=>{D.value=!1,setTimeout((()=>{k.value=!1}),200)},Ie=()=>{x.value=!0,I((()=>{ge.organPid="",ge.organId="",ge.organPName="",ge.organLeaderName="",B.value.resetFields()}))},je=l(!0),xe=()=>{B.value.validate((e=>{e&&(ge.organId?(je.value=!1,_.edit(ge).then((()=>{x.value=!1,ie.value.loaded=!1,ie.value.expand(),ee.value.reloadData(),je.value=!0})).catch((()=>{je.value=!0}))):(ie.value=me.value.getNode(ge.organPid),je.value=!1,_.add(ge).then((()=>{ie.value&&(he.componentsTree.defaultAttribute["current-node-key"]=ge.organPid,G.value=ge.organPid,x.value=!1,ie.value.loaded=!1,ie.value.expand()),ee.value.reloadData(),je.value=!0})).catch((()=>{je.value=!0}))))}))},De=e=>{"organP"===Z.value?(ge.organPid=e.length?e[0].id:"",ge.organPName=e.length?e[0].name:""):(ge.organLeaderId=e.length?e[0].id:"",ge.organLeaderName=e.length?e[0].name:"")};function ke(e,a){if(0===e.level)ie.value=e,_.subOrganList(-1).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),ce.value=e.data,a([{organName:o("accountInfo")&&o("accountInfo").userDepartName,organId:"-1",haveChildren:!1,children:[]}])))).then((()=>{I((()=>{const e=ie.value.childNodes[0];e&&(e.expanded=!0),e&&e.loadData()}))}));else{if(1===e.level)return a(ce.value);_.subOrganList(e.data.organId).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),a(e.data))))}}function Pe(e,a){ie.value=a,G.value=e.organId,ee.value.reloadData()}function _e(e,a,o){1===o.level?oe.value=!1:oe.value=!0,ae.value=!0,ne.value=a,te.value.$el.style.right=0,te.value.$el.style.top=e.layerY+10+"px",document.addEventListener("click",ze)}function ze(){ae.value=!1,document.removeEventListener("click",ze)}function Ae(){x.value=!0,I((()=>{B.value.resetFields(),ge.organPid=ne.value.organId,ge.organPName=ne.value.organName}))}function Te(){x.value=!0,ge.organId=ne.value.organId,I((()=>{B.value.resetFields(),_.detail(ne.value.organId).then((e=>{const a=e.data;ge.organId=a.organId,ge.organNo=a.organNo,ge.organName=a.organName,ge.organTypeId=a.organTypeId,ge.organPid=a.organPid,ge.organPName=a.organPName||JSON.parse(localStorage.getItem("departLists")).find((e=>e.tenantId===localStorage.getItem("tenantId"))).tenantName,ge.organLeaderId=a.organLeaderId,ge.organLeaderName=a.organLeaderName,ge.readme=a.readme}))}))}function Be(){se.value=ne.value.organId,ue.value="t-zgj-Delete",he.showOneAction.show=!0,he.showOneAction.header.data="提示",he.showOneAction.content.data="是否删除该部门"}const Ce=()=>{"t-zgj-dept.BatchDeactivation"===re.value?_.batchDisable(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData()})).finally((()=>{le.value=!1})):"t-zgj-dept.BatchEnable"===re.value?_.batchEnable(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData()})).finally((()=>{le.value=!1})):"t-zgj-seal.BatchDelete"===re.value&&_.batchDelete(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData(),ie.value.loaded=!1,ie.value.expand()})).finally((()=>{le.value=!1}))};return d((()=>{})),(e,o)=>{const l=s("el-button"),r=s("el-dropdown-item"),d=s("el-dropdown-menu"),I=s("el-dropdown"),_=s("el-tree"),T=s("el-card"),Z=s("el-input"),ne=s("el-form-item"),re=s("el-radio"),se=s("el-radio-group"),ue=s("el-form"),ie=t,ce=s("JyElMessageBox");return u(),i("div",null,[c(P,{url:"/organ/page",ref_key:"table",ref:ee,componentsSearchForm:b(he).componentsSearchForm,componentsTableHeader:b(he).componentsTable.header,componentsBatch:b(he).componentsBatch,queryParams:{organId:G.value},statusColoum:"flag",openValue:"启用",hasTree:"",tableClick:"organName",onCellClick:ve,onCustomClick:fe,onClickBatchButton:we},{title:m((()=>[g("div",C,[L,g("div",V,[g("div",O,[c(l,{type:"primary",onClick:Ie},{default:m((()=>[p("+ "+h(e.$t("t-zgj-add")),1)])),_:1})]),g("div",E,[c(I,{"popper-class":"more-operation-dropdown"},{dropdown:m((()=>[c(d,null,{default:m((()=>[c(r,null,{default:m((()=>[S])),_:1})])),_:1})])),default:m((()=>[c(l,null,{default:m((()=>[U,g("span",null,h(e.$t("t-zgj-table.more.Operation")),1)])),_:1})])),_:1})])])])])),tree:m((()=>[g("div",F,[je.value?(u(),v(_,f({key:0,ref_key:"deptTreeRef",ref:me,data:b(he).componentsTree.data,props:b(he).componentsTree.defaultProps},b(he).componentsTree.defaultAttribute,{lazy:"",load:ke,onCurrentChange:Pe,onNodeContextmenu:_e}),null,16,["data","props"])):w("",!0),N(c(T,{class:"box-card",ref_key:"card",ref:te,"body-style":{padding:"0 10px"}},{default:m((()=>[g("div",{class:"add",onClick:Ae},"添加子部门"),N(g("div",{class:"delete",onClick:Te}," 编辑部门 ",512),[[y,oe.value]]),N(g("div",{class:"edit",onClick:Be}," 删除部门 ",512),[[y,oe.value]])])),_:1},512),[[y,ae.value]])])])),_:1},8,["componentsSearchForm","componentsTableHeader","componentsBatch","queryParams"]),c(A,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),modulesName:"unit_and_department",detailParams:j.value},null,8,["modelValue","detailParams"]),c(ie,{"onUpdate:show":o[9]||(o[9]=e=>x.value=e),show:x.value,title:b(ge).organId?e.$t("t-zgj-Edit"):e.$t("t-zgj-add"),centerBtn:!0,confirmText:e.$t("t-zgj-operation.submit"),concelText:e.$t("t-zgj-operation.cancel"),width:900,height:400,onConfirm:xe},{default:m((()=>[c(ue,{model:b(ge),rules:b(pe),ref_key:"vFormLibraryRef",ref:B,"label-width":"80px"},{default:m((()=>[c(ne,{label:"部门名称",prop:"organName"},{default:m((()=>[c(Z,{modelValue:b(ge).organName,"onUpdate:modelValue":o[1]||(o[1]=e=>b(ge).organName=e),placeholder:"请输入",clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),c(ne,{label:"组织类型",prop:"organTypeId"},{default:m((()=>[c(se,{modelValue:b(ge).organTypeId,"onUpdate:modelValue":o[2]||(o[2]=e=>b(ge).organTypeId=e)},{default:m((()=>[c(re,{label:"department",size:"large"},{default:m((()=>[$])),_:1}),c(re,{label:"unit",size:"large"},{default:m((()=>[q])),_:1})])),_:1},8,["modelValue"])])),_:1}),c(ne,{label:"部门编码",prop:"organNo"},{default:m((()=>[c(Z,{modelValue:b(ge).organNo,"onUpdate:modelValue":o[3]||(o[3]=e=>b(ge).organNo=e),placeholder:"请输入",maxlength:"64"},null,8,["modelValue"])])),_:1}),c(ne,{label:"上级部门",prop:"organPName"},{default:m((()=>[g("div",H,[c(Z,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:b(ge).organPName,"onUpdate:modelValue":o[4]||(o[4]=e=>b(ge).organPName=e),placeholder:"请选择",onClick:o[5]||(o[5]=e=>Ne("organP"))},null,8,["modelValue"]),J])])),_:1}),c(ne,{label:"部门领导",prop:"organLeaderId"},{default:m((()=>[g("div",R,[c(Z,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:b(ge).organLeaderName,"onUpdate:modelValue":o[6]||(o[6]=e=>b(ge).organLeaderName=e),placeholder:"请选择",onClick:o[7]||(o[7]=e=>Ne("leaderUser"))},null,8,["modelValue"]),W])])),_:1}),c(ne,{label:"备注",prop:"readme"},{default:m((()=>[c(Z,{modelValue:b(ge).readme,"onUpdate:modelValue":o[8]||(o[8]=e=>b(ge).readme=e),type:"textarea",maxlength:"512"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["show","title","confirmText","concelText"]),k.value?(u(),v(b(a),{key:0,show:D.value,"onUpdate:show":ye,searchSelected:Q.value,"onUpdate:searchSelected":De,tabsShow:X.value,multiple:!1,hasTopRoot:!0},null,8,["show","searchSelected","tabsShow"])):w("",!0),c(b(z),{"onUpdate:modelValue":o[10]||(o[10]=e=>le.value=!1),show:le.value,selectionData:b(he).componentsBatch.selectionData,showToastDialogContent:de.value,label:"organName",onSureAction:Ce},null,8,["show","selectionData","showToastDialogContent"]),c(ce,{modelValue:b(he).showOneAction.show,"onUpdate:modelValue":o[11]||(o[11]=e=>b(he).showOneAction.show=e),mode:1,showClose:!1,defaultAttribute:{},onConfirmClick:be},{header:m((()=>[g("div",M,[Y,g("span",null,h(b(he).showOneAction.header.data),1)])])),content:m((()=>[g("div",K,h(b(he).showOneAction.content.data),1)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-36305306"]]);export{Q as default};

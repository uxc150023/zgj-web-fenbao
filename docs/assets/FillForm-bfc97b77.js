import{g as e,j as a,u as l,Q as t,a6 as s,a8 as n,a9 as i}from"./chunk-vform-2b3347cb.js";import o from"./index-f895f36f.js";import c from"./index-e746fa70.js";import{aA as r,ay as d,ag as u,al as m,aF as f,as as p,o as v,x as g,bj as y,p as I,a$ as h,bl as w,bb as b,m as P,n as x,F as k,aD as D,aa as j,aT as S,w as V,ab as _,aw as N,at as M}from"./chunk-vue-0eb5cee7.js";import{_ as T}from"./back-bdc75944.js";import{_ as J}from"./step_next-7a8cf5a2.js";import{c as O}from"./Layout-feb68f7d.js";import{S as q}from"./JyStep-e74e1456.js";import{_ as F}from"./index-11f52a3c.js";import{E as C}from"./chunk-element-plus-b8773542.js";import"./chunk-ant-design-vue-bd7f8294.js";import"./chunk-@ant-design-icons-svg-8f5189a2.js";import"./chunk-@ant-design-icons-vue-ff9a333c.js";import"./index-c5d7142e.js";import"./home-back-d5b479fa.js";import"./logo-ad08cc7e.js";import"./request-util-29e45969.js";const L=e=>(N("data-v-5dd70f9f"),e=e(),M(),e),A={class:"Seal-application-fill-form"},U={class:"breadcrumb"},z=V(" 用印申请 "),Q=V(" 新建用印申请 "),E=V(" 新建用印申请 "),B=L((()=>I("div",null,null,-1))),H={class:"custom-buzhou"},R={class:"custom"},Y={key:1},$={class:"PrintingProcess"},G={class:"PrintingProcess-content"},K={class:"PrintingProcess-content-list-cont"},W={class:"PrintingProcess-content-list-cont-title"},X=L((()=>I("img",{class:"PrintingProcess-content-list-cont-title-img",src:"/zgj-web/assets/calendar-67a958ae.svg",alt:""},null,-1))),Z={class:"PrintingProcess-content-list-cont-title-span"},ee={class:"PrintingProcess-content-list-cont-list-name"},ae=L((()=>I("div",{class:"PrintingProcess-content-list-cont-list-icon"},[I("img",{class:"PrintingProcess-content-list-cont-list-icon-img",src:"/zgj-web/assets/tips-e93e6fe1.svg",alt:""})],-1))),le={class:"PrintingProcess-content-list-iocn"},te={key:0,class:"PrintingProcess-content-list-iocn-img",src:J,alt:""},se={key:0,class:"fixed"},ne={class:"ap-fixed"},ie=V("下一步"),oe=L((()=>I("span",{class:"ap-fixed-save-text"}," 保存模板 ",-1))),ce=L((()=>I("div",{style:{width:"300px"}}," 模板可用于提高重复发起同种类型用印申请的填写效率，一种文件类型仅允许保存一个模板，保存后可在申请页面直接引用 ",-1))),re=L((()=>I("i",{class:"ap-fixed-save-icon"},[I("svg",{class:"iconpark-icon"},[I("use",{href:"#icon4"})])],-1))),de={key:1,class:"fixed"},ue={class:"ap-fixed"},me=V("提交 "),fe=V("上一步"),pe=V(" 若当前文件类型已有模版则会覆盖，若当前文件类型没有模板则会创建，请问确定要保存吗？ "),ve=e({setup(e){const V=a(),N=l(),M=r(null),J=r(null),L=r(null),ve=r(null),ge=r(N.query.formVersionId),ye=r(null),Ie=r(!1),he=d({cache:{flowList:[{name:"填写表单信息",active:!0},{name:"确认审批流程",active:!1},{name:"完成",active:!1}],formData:{},optionData:{},SealformData:{},SealoptionData:{},PrintingProcess:{list:[{title:"盖前",list:[{name:"说明详情后续补上"}]},{title:"实时视频盖章",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖中",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖后",list:[{name:"说明详情后续补上"}]},{title:"归档",list:[{name:"说明详情后续补上"}]}]}}}),we=r(null),be=r("one"),Pe=r(null),xe=r([]),ke=r(null),De=r(!1),je=r(null),Se=r({}),Ve=r(null),_e=r({padding:"24px 0 24px 24px"}),Ne=()=>{t.templateAdd({formVersionId:ge.value,templateName:je.value.applyName,fileTypeId:je.value.fileTypeId,templateValue:JSON.stringify(je.value)}).then((e=>{C.success("保存模板成功"),De.value=!1})).catch((()=>{De.value=!1}))},Me=()=>{De.value=!1};function Te(){V.go(-1)}function Je(){we.value.getFormData().then((e=>{he.cache.formData=e;const a=he.cache.flowList;a[0].active=!1,a[1].active=!0,he.cache.flowList=JSON.parse(JSON.stringify(a)),be.value="two",t.flowList({formMessageId:N.query.formMessageId,fileTypeId:e.fileTypeId}).then((e=>{e.data&&e.data.length&&(xe.value=e.data,ke.value=e.data[0].flowMessageId,ye.value=e.data[0].flowVersionId,Fe(e.data[0].modelId,e.data[0].definitionId))}))}))}const Oe=async()=>{je.value=null;const e=await we.value.getFormData(!1);e.fileTypeId||e.applyName?(je.value=e,De.value=!0):C.warning("单据名称和文件类型必填，否则不允许保存模板")};function qe(){const e=xe.value.find((e=>e.flowMessageId===ke.value));ye.value=e.flowVersionId,Fe(e.modelId,e.definitionId)}function Fe(e,a){M.value={modelId:e,definitionId:a},t.flowDetail({...M.value,edit:!0}).then((async e=>{Ve.value=null,_((()=>{Ve.value=e.data.data,_((()=>{Se.value={height:document.getElementById("flow-designer-box").clientHeight+"px",overflow:"hidden"}}))}))}))}function Ce(){const e=he.cache.flowList;e[0].active=!0,e[1].active=!1,he.cache.flowList=JSON.parse(JSON.stringify(e)),be.value="one"}function Le(){if(!ke.value)return void C.warning("请选择审批流程");const e=i;let a={},l={};for(const t in he.cache.formData){e.indexOf(t)>-1?a={...a,[t]:he.cache.formData[t]}:l={...l,[t]:he.cache.formData[t]}}const s={modelId:M.value.modelId,definitionId:M.value.definitionId,instanceName:he.cache.formData.applyName,suggest:null,formData:{...he.cache.formData,formVersionId:ge.value,flowVersionId:ye.value,formMessageId:N.query.formMessageId,flowMessageId:ke.value},variable:{subType:J.value,instanceType:L.value}};Ie.value=!0,t.submit(s).then((e=>{t.add({formMessageId:N.query.formMessageId,formVersionId:ge.value,flowVersionId:ye.value,applyTypeId:J.value,sealUseTypeId:ve.value,flowMessageId:ke.value,gunsSysId:e.data.data.instanceId,customApplyField:"{}"===JSON.stringify(l)?null:l,...a}).then((()=>{V.replace({path:"/frontDesk/printControlManage/useSealManage/sealApplication/accomplish",query:{applyNo:he.cache.formData.applyNo}})})).finally((()=>{Ie.value=!1}))})).finally((()=>{Ie.value=!1}))}return u((()=>{N.query.useId?t.formQuery({formMessageId:N.query.formMessageId}).then((e=>{J.value=e.data.applyTypeId,L.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,Pe.value=JSON.parse(e.data.formInfo),t.templateView(N.query.useId).then((e=>{ge.value=e.data.formVersionId,we.value.setFormData(JSON.parse(e.data.templateValue)),_((()=>{we.value.setFieldValue("applyNo",s())}))}))})):t.formQuery({formMessageId:N.query.formMessageId}).then((e=>{J.value=e.data.applyTypeId,L.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,Pe.value=JSON.parse(e.data.formInfo),_((()=>{we.value.setFieldValue("applyNo",s())}))}))})),m((()=>{})),(e,a)=>{const l=f("el-breadcrumb-item"),t=f("el-breadcrumb"),s=c,i=f("el-option"),r=f("el-select"),d=o,u=f("el-scrollbar"),m=f("el-button"),V=f("el-tooltip"),_=n;return p(),v("div",A,[g(O,{Layout:"breadcrumb,title,custom,fixed",cardStyle:_e.value},{breadcrumb:y((()=>[I("div",U,[g(t,{separator:"/"},{default:y((()=>[g(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.65)"}},{default:y((()=>[z])),_:1}),g(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.25)"}},{default:y((()=>[Q])),_:1})])),_:1})])])),title:y((()=>[I("div",{class:"title"},[I("div",{class:"title-desc"},[I("img",{class:"title-desc-img",src:T,alt:"",onClick:Te}),E]),B])])),custom:y((()=>[I("div",H,[g(q,{data:h(he).cache.flowList},null,8,["data"])]),g(u,{height:"calc(100vh - 300px)",style:{"padding-right":"24px"}},{default:y((()=>[I("div",R,[Pe.value?w((p(),P(s,{key:0,mode:"render",formJson:Pe.value,formData:h(he).cache.formData,optionData:h(he).cache.optionData,ref_key:"refFillFormInformation",ref:we},null,8,["formJson","formData","optionData"])),[[b,"one"===be.value]]):x("",!0),"two"===be.value?(p(),v("div",Y,[g(d,{label:"审批流程"},{right:y((()=>[g(r,{modelValue:ke.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ke.value=e),placeholder:"请选择流程",onChange:qe},{default:y((()=>[(p(!0),v(k,null,D(xe.value,(e=>(p(),P(i,{key:e.flowMessageId,label:e.flowName,value:e.flowMessageId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Ve.value?(p(),P(F,j({key:0,id:"flow"},{readable:!0,mapable:!1,scroll:!1,scrollY:!1,top:"50"},{node:Ve.value,wrapStyle:Se.value}),null,16,["node","wrapStyle"])):x("",!0),I("div",$,[g(d,{label:"用印流程"}),I("div",G,[(p(!0),v(k,null,D(h(he).cache.PrintingProcess.list,((e,a)=>(p(),v("div",{class:"PrintingProcess-content-list",key:a},[I("div",K,[I("div",W,[X,I("span",Z,S(e.title),1)]),(p(!0),v(k,null,D(e.list,((e,a)=>(p(),v("div",{class:"PrintingProcess-content-list-cont-list",key:a},[I("div",ee,S(e.name),1),ae])))),128))]),I("div",le,[a<h(he).cache.PrintingProcess.list.length-1?(p(),v("img",te)):x("",!0)])])))),128))])])])):x("",!0)])])),_:1})])),fixed:y((()=>["one"===be.value?(p(),v("div",se,[I("div",ne,[g(m,{type:"primary",onClick:Je},{default:y((()=>[ie])),_:1}),g(m,{class:"ap-fixed-save",onClick:Oe},{default:y((()=>[oe,g(V,{class:"box-item",effect:"dark",content:"",placement:"top"},{content:y((()=>[ce])),default:y((()=>[re])),_:1})])),_:1})])])):x("",!0),"two"===be.value?(p(),v("div",de,[I("div",ue,[g(m,{type:"primary",loading:Ie.value,onClick:Le},{default:y((()=>[me])),_:1},8,["loading"]),g(m,{onClick:Ce},{default:y((()=>[fe])),_:1})])])):x("",!0)])),_:1},8,["cardStyle"]),g(_,{modelValue:De.value,"onUpdate:modelValue":a[1]||(a[1]=e=>De.value=e),mode:1,onOnConfirm:Ne,onOnCancel:Me,title:"保存模版"},{default:y((()=>[pe])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5dd70f9f"]]);export{ve as default};

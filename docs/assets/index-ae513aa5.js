import{g as e}from"./chunk-vform-6b80d696.js";import{k as t,aA as a,be as l,aF as n,as as s,o,x as i,bj as u,p as r,ae as c,a$ as d,aT as v,a4 as f,aw as p,at as h}from"./chunk-vue-0eb5cee7.js";import"./chunk-element-plus-b8773542.js";import"./chunk-ant-design-vue-bd7f8294.js";import"./chunk-@ant-design-icons-svg-8f5189a2.js";import"./chunk-@ant-design-icons-vue-ff9a333c.js";const m=e=>(p("data-v-444f0115"),e=e(),h(),e),g={class:"vertify-box"},y={class:"vertify"},w={class:"content"},b={className:"canvasArea"},C=["width","height"],k=["width","height"],x=["className"],T=[m((()=>r("use",{href:"#btn1",class:"btn1"},null,-1))),m((()=>r("use",{href:"#btn2",class:"btn2"},null,-1)))],N={className:"sliderText"},M=[m((()=>r("div",{className:"loadingIcon"},null,-1))),m((()=>r("span",null,"加载中...",-1)))],R=m((()=>r("svg",{class:"iconpark-icon"},[r("use",{href:"#close"})],-1))),S=[m((()=>r("use",{href:"#flush"},null,-1)))],I=e({props:{title:{type:String,default:"title"},width:{type:Number,default:280},modelValue:{type:Boolean,default:!0},height:{type:Number,default:160},visible:{type:Boolean,default:()=>!0},l:{type:Number,default:42},r:{type:Number,default:9},imgUrl:{type:String,default:""},text:{type:String,default:"拖动滑块完成拼图"},onDraw:()=>{},onCustomVertify:()=>{},onBeforeRefresh:()=>{},onSuccess:()=>{},onFail:()=>{},onRefresh:()=>{}},emits:["update:modelValue","on-closed","click","on-success","on-failed"],setup(e,{emit:p}){const h=e,m=t({get:()=>h.modelValue,set(e){p("update:modelValue",e)}}),I=()=>{p("on-closed")},{text:V,l:_,r:X,imgUrl:j,width:D,height:A,visible:B,onBeforeRefresh:F,onRefresh:O,onFail:U,onSuccess:Y,onCustomVertify:$,onDraw:q}=h,E=a(!0),L=a(0),P=a("sliderContainer"),W=a(V),G=a(null),H=a(null),z=a(null),J=a(!1),K=a([]),Q=a(0),Z=a(0),ee=a(0),te=a(0),ae=Math.PI,le=_+2*X+3,ne=(e,t,a,l)=>{e.beginPath(),e.moveTo(t,a),e.arc(t+_/2,a-X+2,X,.72*ae,2.26*ae),e.lineTo(t+_,a),e.arc(t+_+X-2,a+_/2,X,1.21*ae,2.78*ae),e.lineTo(t+_,a+_),e.lineTo(t,a+_),e.arc(t+X-2,a+_/2,X+.4,2.76*ae,1.24*ae,!0),e.lineTo(t,a),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over","fill"===l?e.fill():e.clip()},se=()=>j||`https://picsum.photos/id/${fe(0,1084)}/${D}/${A}`,oe=()=>{const e=(e=>{const t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=()=>{t.setSrc(se())},t.setSrc=e=>{if(window.navigator.userAgent.indexOf("Trident")>-1){const a=new XMLHttpRequest;a.onloadend=function(e){const a=new FileReader;a.readAsDataURL(e.target.response),a.onloadend=function(e){t.src=e.target.result}},a.open("GET",e),a.responseType="blob",a.send()}else t.src=e},t.setSrc(se()),t})((()=>{E.value=!1,(e=>{const t=G.value.getContext("2d"),a=H.value.getContext("2d");ee.value=fe(le+10,D-(le+10)),te.value=fe(10+2*X,A-(le+10)),ne(t,ee.value,te.value,"fill"),ne(a,ee.value,te.value,"clip"),t.drawImage(e,0,0,D,A),a.drawImage(e,0,0,D,A);const l=te.value-2*X-1,n=a.getImageData(ee.value-3,l,le,le);H.value.width=le,a.putImageData(n,0,l)})(e)}));z.value=e},ie=()=>{const e=G.value.getContext("2d"),t=H.value.getContext("2d");L.value=0,P.value="sliderContainer",H.value.width=D,H.value.style.left="0px",e.clearRect(0,0,D,A),t.clearRect(0,0,D,A),F&&F(),E.value=!0,z.value.setSrc(se())},ue=()=>{ie(),"function"==typeof O&&O()},re=()=>{const e=K.value,t=e.reduce(pe)/e.length,a=e.map((e=>e-t)),l=Math.sqrt(a.map(he).reduce(pe)/e.length),n=parseInt(H.value.style.left);return{spliced:Math.abs(n-ee.value)<10,verified:0!==l,left:n,destX:ee.value}},ce=function(e){Q.value=e.clientX||e.touches[0].clientX,Z.value=e.clientY||e.touches[0].clientY,J.value=!0},de=e=>{if(!J.value)return!1;e.preventDefault();const t=e.clientX||e.touches[0].clientX,a=e.clientY||e.touches[0].clientY,l=t-Q.value,n=a-Z.value;if(l<0||l+38>=D)return!1;L.value=l;const s=(D-40-20)/(D-40)*l;H.value.style.left=s+"px",P.value="sliderContainer sliderContainer_active",K.value.push(n),q&&q(s)},ve=e=>{if(!J.value)return!1;J.value=!1;if((e.clientX||e.changedTouches[0].clientX)===Q.value)return!1;P.value="sliderContainer";const{spliced:t,verified:a}=$?$(re()):re();t?a?(P.value="sliderContainer sliderContainer_success","function"==typeof Y&&Y(),m.value=!1,p("on-success")):(P.value="sliderContainer sliderContainer_fail",W.value="请再试一次",p("on-failed"),ie()):(P.value="sliderContainer sliderContainer_fail","function"==typeof U&&U(),setTimeout(ie.bind(this),1e3))},fe=(e,t)=>Math.round(Math.random()*(t-e)+e),pe=(e,t)=>e+t,he=e=>e*e,me=()=>{oe()};return l((()=>B),(()=>{B&&(z.value?ie():oe())})),(e,t)=>{const a=n("el-dialog");return s(),o("div",g,[i(a,{modelValue:d(m),"onUpdate:modelValue":t[0]||(t[0]=e=>f(m)?m.value=e:null),width:d(D),center:"","align-center":"","destroy-on-close":"",onClosed:I,onOpen:me},{default:u((()=>[r("div",y,[r("div",w,[r("div",{className:"vertifyWrap",style:c({width:d(D)+"px",margin:"0 auto",display:d(B)?"":"none"}),onMousemove:de,onMouseup:ve,onTouchmove:de,onTouchend:ve},[r("div",b,[r("canvas",{ref_key:"canvasRef",ref:G,width:d(D),height:d(A)},null,8,C),r("canvas",{ref_key:"blockRef",ref:H,className:"block",width:d(D),height:d(A),onMousedown:ce,onTouchstart:ce},null,40,k)]),r("div",{className:P.value,style:c({pointerEvents:E.value?"none":"auto"})},[r("div",{className:"sliderMask",style:c({width:L.value>0?L.value+8+"px":L.value+"px"})},[(s(),o("svg",{class:"iconpark-icon slider",style:c({left:L.value-10+"px"}),onMousedown:ce,onTouchstart:ce},T,36))],4),r("div",N,v(W.value),1)],12,x),r("div",{className:"loadingContainer",style:c({width:d(D)+"px",height:d(A)+"px",display:E.value?"":"none"})},M,4)],36),r("div",{class:"vertify-footer"},[R,r("svg",{class:"iconpark-icon",onClick:ue},S)])])])])),_:1},8,["modelValue","width"])])}}},[["__scopeId","data-v-444f0115"]]);export{I as default};
